{% extends "layout.html" %}

{% block title %}
    Portfolio
{% endblock %}

{% block main %}
    <div>
        <form id="edit-shares-form" action="/edit" method="post">
        <!-- Stocks list -->
            <table class="table table-dark table-striped text-light table-hover">
                <thead>
                <tr>
                    <th scope="col">Symbol</th>
                    <th scope="col">Name</th>
                    <th scope="col">Shares</th>
                    <th scope="col">+/-</th>
                    <th scope="col">Weight</th>
                    <th scope="col">Price</th>
                    <th scope="col">Total</th>
                </tr>
                </thead>
                <tbody>
                {% for stock in stocks %}
                    <tr>
                        <th scope="row">{{ stock.symbol }}</th>
                        <td>{{ stock.name }}</td>
                        <td>
                            <div class="d-flex justify-content-center gap-1 w-180 m-auto">
                                <button data-symbol="{{ stock.symbol }}" type="button" class="btn btn-primary btn-sq" onclick="updateTable(this.getAttribute('data-symbol'), false)">-</button>
                                <input data-symbol="{{ stock.symbol }}" data-shares="{{ stock.shares }}" autocomplete="off" class="shares-input form-control mx-auto text-center bg-secondary text-light border-0" id="{{ stock.symbol }}-shares" name="{{ stock.symbol }}" placeholder="Shares" type="number" value="{{ stock.shares }}"  onkeyup="updateTable(this.getAttribute('data-symbol'))">
                                <button data-symbol="{{ stock.symbol }}" type="button" class="btn btn-primary btn-sq" onclick="updateTable(this.getAttribute('data-symbol'), true)">+</button>
                            </div>
                        </td>
                        <td>
                            <div id="variation-container-{{ stock.symbol }}" class="d-flex justify-content-center">
                                <span id="variation-prefix-{{ stock.symbol }}"></span>
                                <span id="variation-{{ stock.symbol }}">0</span>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span id="{{ stock.symbol }}-weight" class="shares-weight">
                                    {{ "%0.2f" | format((stock.total / total * 100) | float) }}
                                </span>
                                <span>&nbsp%</span>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span>R$&nbsp</span>
                                <span id="{{ stock.symbol }}-price">
                                    {{ stock.price }}
                                </span>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span>R$&nbsp</span>
                                <span id="{{ stock.symbol }}-total">
                                    {{ stock.total }}
                                </span>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
                    <tr>
                        <th scope="row" colspan="6">TOTAL</th>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span>R$&nbsp</span>
                                <span id="total" class="fw-bold">
                                    {{ total }}
                                </span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>

        <!-- Add stock modal -->
        <div class="modal fade" id="add-stock-modal" tabindex="-1" aria-labelledby="add-stock-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header border-0">
                        <h1 class="modal-title fs-5" id="add-stock-label">Add a new stock to the portfolio</h1>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex flex-column text-start">
                        <p class="fw-light text-warning">This action will discard any edits you made to the portfolio. If you want to keep your changes, save your portfolio before adding new stocks.</p>
                        <form id="add-stock-form" action="/add" method="post">
                            <div class="d-flex justify-content-evenly gap-5 m-auto w-100">
                                <div>
                                    <label for="symbol">Symbol:</label><br>
                                    <input autofocus class="form-control mx-auto w-auto text-center bg-secondary text-light" id="symbol" name="symbol" placeholder="PETR4" type="text">
                                </div>
                                <div>
                                    <label for="shares">Shares:</label><br>
                                    <input class="form-control mx-auto w-auto text-center bg-secondary text-light" id="shares" name="shares" placeholder="Shares" type="number" value="1">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Close</button>
                        <button type="submit" form="add-stock-form" class="btn btn-primary">Add</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Undo changes modal -->
        <div class="modal fade" id="restore-modal" tabindex="-1" aria-labelledby="restore-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header border-0">
                        <h1 class="modal-title fs-5" id="restore-label">Undo changes</h1>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex flex-column text-start">
                        <p>Undo all edits made to the portfolio?</p>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn p-0">
                            <a class="btn btn-primary" href="/">Undo</a>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete portfolio modal -->
        <div class="modal fade" id="delete-portfolio-modal" tabindex="-1" aria-labelledby="delete-portfolio-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header border-0">
                        <h1 class="modal-title fs-5" id="delete-portfolio-label">Delete portfolio</h1>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex flex-column text-start">
                        <p>Delete your portfolio?</p>
                        <p class="text-danger">This action is irreversible.</p>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <form action="/delete" method="post">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save portfolio modal -->
        <div class="modal fade" id="save-portfolio-modal" tabindex="-1" aria-labelledby="save-portfolio-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header border-0">
                        <h1 class="modal-title fs-5" id="save-portfolio-label">Save portfolio</h1>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body d-flex flex-column text-start">
                        <p>Save changes made to the portfolio?</p>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" form="edit-shares-form" class="btn btn-primary">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating button -->
        {% if session["user_id"] %}
            <div class="btn-group floating-container">
                <button type="button" class="btn btn-primary dropdown-toggle rounded-circle no-caret btn-floating" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://img.icons8.com/ios-filled/50/menu-2.png" alt="sorting-options--v1" alt="plus-math" width="30" class="filter-invert-100">
                </button>
                <ul class="dropdown-menu dropdown-menu-dark">
                    <li>
                        <!-- Button trigger add modal -->
                        <button type="button" class="dropdown-item d-flex align-items-center p-2" data-bs-toggle="modal" data-bs-target="#add-stock-modal">
                            <img width="20" height="20" src="https://img.icons8.com/ios-glyphs/30/plus-math.png" alt="add" class="me-2 filter-invert-100"/>
                            Add new stock
                        </button>
                    </li>
                    <li>
                        <!-- Button trigger restore modal -->
                        <button type="button" class="dropdown-item d-flex align-items-center p-2" data-bs-toggle="modal" data-bs-target="#restore-modal">
                            <img width="20" height="20" src="https://img.icons8.com/ios-glyphs/30/undo.png" alt="undo" class="me-2 filter-invert-100"/>
                            Undo
                        </a>
                    </li>
                    <li>
                        <!-- Button trigger delete modal -->
                        <button type="button" class="dropdown-item d-flex align-items-center p-2" data-bs-toggle="modal" data-bs-target="#delete-portfolio-modal">
                            <img width="20" height="20" src="https://img.icons8.com/material-outlined/24/trash--v1.png" alt="filled-trash" alt="delete" class="me-2 filter-invert-100"/>
                            Delete potfolio
                        </button>
                    </li>
                    <li>
                        <!-- Button trigger save modal -->
                        <button type="button" class="dropdown-item d-flex align-items-center p-2" data-bs-toggle="modal" data-bs-target="#save-portfolio-modal">
                            <img width="20" height="20" src="https://img.icons8.com/material-outlined/24/save.png" alt="save" class="me-2 filter-invert-100"/>
                            Save potfolio
                        </button>
                    </li>
                </ul>
            </div>
        {% endif %}

    </div>
{% endblock %}
